<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
function setCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function getCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){setCookie(a,"",-1)}function show(a){$(a).show()}function hide(a){$(a).hide()}function displayPoints(){var a=$("#points");$(a).is(":visible")?hide(a):show(a)}function displayHisto(){var a=$("#histo");$(a).is(":visible")?hide(a):show(a)}function goToManual(){location.href="/manual.html"}function quit(){window.alert("Merci de fermer votre onglet ou votre navigateur")}function displayHighScore(){if(null===highscoreCookies)return!1;var a,b,c=JSON.parse(highscoreCookies),d=9999;do{for(var e in c)c[e].forEach(function(c,f){c<d&&(d=c,a=e,b=f)});addHighScore(a,d),c[a].splice(b,1),0===c[a].length&&delete c[a],d=9999}while(!$.isEmptyObject(c))}function addHighScore(a,b){var c=$("#score-list"),d=$("<li>"+a+" <span class='right'>"+b+"</span></li>");c.append(d)}function chooseGameType(a){switch(a){case"solo":removeSection("#gametype"),showSection("#gamelevel");break;case"duo":removeSection("#gametype"),showSection("#pickname")}}function chooseGameLevel(a){var b=a;switch(b){case"easy":selectMode(b);break;case"medium":selectMode(b);break;case"hard":selectMode(b)}}function selectMode(a){removeSection("#gamelevel"),addModeToButton(a),removeP2(),showSection("#pickname")}function removeP2(){$("#pickname > #groupej2").hide()}function addModeToButton(a){$("#start").attr("mode",a)}function affectName(){startFirstRound()}function startFirstRound(){p1.addRound(),$("#round").html(p1.round)}function removeSection(a){$(a).fadeOut(300)}function showSection(a){setTimeout(function(){$(a).fadeIn(500)},400)}var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a},Player=function(){"use strict";function a(a,b){var c=arguments[2];void 0===c&&(c="duo"),this.id=b,this.name=a,this.round=0,this.score=0,this.eated={},this.mode=c,this.isBot="duo"!==c,$("#player"+this.id).html(this.name)}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.addRound=function(){this.round++},b.addPoints=function(a){var b=this.didCombo(a)?3*a:a;this.score+=b,$("#score"+this.id).html(this.score),$("#last-score-list").prepend("<li>"+this.name+": "+b+" points</li>")},b.cleanEated=function(){this.eated={}},b.didCombo=function(a){return void 0===this.eated[a]?(this.cleanEated(),this.eated[a]=1):this.eated[a]+=1,5===this.eated[a]&&($("body").prepend('<img class="gifEvent" src="/assets/anim/combo.gif" />'),setTimeout(function(){$(".gifEvent").remove()},2e3),this.cleanEated(),!0)},b.move=function(){switch(this.mode){case"easy":AI.easyMove();break;case"medium":AI.mediumMove();break;case"hard":AI.hardMove()}},MIXIN$0(a.prototype,b),b=void 0,a}(),AI={possiblePositions:function(){for(var a=[],b=1;b<8;b++){var c=[b,MainChar.currentPosition()[1]];c[0]!==MainChar.currentPosition()[0]&&a.push(c)}for(var d=1;d<8;d++){var e=[MainChar.currentPosition()[0],d];e[1]!==MainChar.currentPosition()[1]&&a.push(e)}return a},getTarget:function(){return"div[data-x="+this.newPosition[0]+"][data-y="+this.newPosition[1]+"]"},setNewPos:function(a){var b=Math.floor(Math.random()*a.length);this.newPosition=a[b]},easyMove:function(){Math.floor(Math.random()*this.possiblePositions().length);this.setNewPos(this.possiblePositions()),this.moveChar()},mediumMove:function(){for(var a=this.possiblePositions(),b=0;b<a.length;b++)var c=$("div[data-x="+a[b][0]+"][data-y="+a[b][1]+"]");0!==c.children().length&&c.find("img").attr("data-id")||(a[i]=null),a=$.grep(a,function(a){return 0==a||a}),a=0===a.length?this.possiblePositions():a,this.setNewPos(a),this.moveChar()},hardMove:function(){for(var a=null,b=0,c=0;c<this.possiblePositions().length;c++){var d=$("div[data-x="+this.possiblePositions()[c][0]+"][data-y="+this.possiblePositions()[c][1]+"]");if(d.children().length>0&&d.find("img").attr("data-id")){var e=d.find("img").data("id");Game.enemies[e].points()>b&&(b=Game.enemies[e].points(),a=this.possiblePositions()[c])}}this.newPosition=a,this.moveChar()},moveChar:function(){var a=$(this.getTarget()).offset(),b=$("#main-char").parent("div").offset();$("#main-char").css("transition","1s"),$("#main-char").css("left",a.left-b.left),$("#main-char").css("top",a.top-b.top),setTimeout(function(){$("#main-char").css("transition","none"),MainChar.eat(AI.getTarget())},1e3)}},actualPlayer="",turn=1,Game={enemies:[],columns_nb:49,mode:"",init:function(){$(document).on("click","#start",function(){Game.mode=$("#start").attr("mode"),Game.setPlayers(),Game.launchGame(),GameAudio.startTheme()})},setPlayers:function(){this.p1=new Player($("#pickname #namej1").val(),1),"duo"!==this.mode?this.p2=new Player("El Scobar",2,this.mode):this.p2=new Player($("#pickname #namej2").val(),2)},launchGame:function(){this.setPlate(),this.setEnemies(),MainChar.init(),this.setEvents()},setPlate:function(){for(var a=0,b=0,c=0;c<Game.columns_nb;c++)c%7===0&&a++,b=c%7+1,$("#game").append("<div data-x='"+b+"' data-y='"+a+"' id='case-"+(c+1)+"' class='case'></div>")},setEvents:function(){$(".case").droppable({accept:function(a){if(MainChar.isOnSameLine($(this).data("x"),$(this).data("y"))&&!MainChar.isOnSameCase($(this).data("x"),$(this).data("y")))return!0},drop:function(a,b){var c=MainChar.eat(a.target);return"duo"!==Game.currentPlayer().mode&&$(document).trigger("hasPlayed"),c}}),$(document).on("hasPlayed",function(){setTimeout(function(){Game.p2.move()},2e3)})},setEnemies:function(){for(var a=0;a<14;a++)this.enemies.push(new Enemy(0,1)),this.enemies.push(new Enemy(0,2)),this.enemies.push(new Enemy(0,3));for(var b=0;b<5;b++)this.enemies.push(new Enemy(0,4));this.enemies.sort(function(){return.5-Math.random()});for(var c=[],d=0;d<47;d++)[3,10,17,21,22,23,24,25,26,27,31,38,45].includes(d)||c.push(d);var e=c[Math.floor(Math.random()*c.length)];this.enemies.splice(e,0,new Enemy(0,5)),this.showEnemies()},showEnemies:function(){for(var a=0;a<this.enemies.length+1;a++)if(24!==a){var b=a>24?a-1:a,c=a+1,d=Math.random()>=.5?"rotate":"";this.enemies[b].case_id=c,$("#case-"+this.enemies[b].case_id).append("                    <img data-id='"+b+"' class='"+d+"' src='"+this.enemies[b].image()+"'>                ")}},currentPlayer:function(){return this.p2.round>=this.p1.round?this.p1:this.p2},checkVictory:function(){this.winner()&&(this.addHighScore(this.winner()),GameAudio.stopTheme(),GameAudio.audios.effects.win.play(),this.congratulate())},winner:function(){return this.p1.score>=500?this.p1:this.p2.score>=500&&this.p2},congratulate:function(){confirm(this.winner().name+" a gagnÃ© !!!!! Voulez-vous rejouer ?")?document.location.reload():$("#main-char").draggable("disable")},addHighScore:function(a){var b,c={},d=a.name,e=a.round;null!==highscoreCookies?(c=JSON.parse(highscoreCookies),c.hasOwnProperty(d)?c[d].push(e):c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b)):(c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b))}};MainChar={init:function(){$(".case:not(:has(>img))").append("<img id='main-char' style='z-index:9999;' src='assets/img/personnageprincipal.png'>"),this.updatePosition($("#main-char").parent("div")),$("#main-char").draggable({containment:"#game",revert:function(a,b){return a||$("#main-char").attr("src","/assets/anim/rollingAnimation.gif"),!a},start:function(){$("#main-char").attr("src","/assets/anim/dragAnimation.gif")},stop:function(){"/assets/anim/dragAnimation.gif"==$("#main-char").attr("src")&&$("#main-char").attr("src","/assets/img/personnageprincipal.png")}})},eat:function(a){var b=$(a).find("img").data("id"),c=$(a).data("x"),d=$(a).data("y");if("undefined"!=typeof b&&MainChar.isOnSameLine(c,d)){var e=$("#main-char"),f=$(a).find("img");Game.currentPlayer().addPoints(Game.enemies[b].points()),GameAudio.audios.effects.beat.play(),e.css("right","+=25"),f.css("left","+=25"),f.attr("src","/assets/anim/animEnemy"+Game.enemies[b].type+".gif"),e.attr("src","/assets/anim/animPersoPrincipal.gif"),setTimeout(function(){e.css("right","+=-25"),f.remove(),e.attr("src","/assets/img/personnageprincipal.png"),Game.enemies[b]=null,Game.checkVictory()},1100)}return Game.currentPlayer().addRound(),this.updatePosition(a),MainChar.isOnSameLine(c,d)},isOnSameLine:function(a,b){return $("#main-char").data("x")===a||$("#main-char").data("y")===b},isOnSameCase:function(a,b){return $("#main-char").data("x")===a&&$("#main-char").data("y")===b},currentPosition:function(){return[parseInt($("#main-char").data("x")),parseInt($("#main-char").data("y"))]},updatePosition:function(a){$("#main-char").data("x",$(a).data("x")),$("#main-char").data("y",$(a).data("y")),Game.currentPlayer().name!=actualPlayer&&(1==turn?($(".player > #player1").parent().removeClass("inactive").addClass("active"),$(".player > #player2").parent().removeClass("active").addClass("inactive"),turn=2):($(".player > #player1").parent().removeClass("active").addClass("inactive"),$(".player > #player2").parent().removeClass("inactive").addClass("active"),turn=1)),actualPlayer=Game.currentPlayer().name}};var Enemy=function(){"use strict";function a(a,b){this.case_id=a,this.type=b}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.points=function(){var a=0;switch(this.type){case 1:a=10;break;case 2:a=20;break;case 3:a=30;break;case 4:a=50;break;case 5:a=100}return a},b.image=function(){return"assets/img/ennemy"+this.type+".png"},MIXIN$0(a.prototype,b),b=void 0,a}();Game.init();var highscoreCookies=getCookie("highscore");displayHighScore(),$("#play").click(function(){removeSection("#menu"),showSection("#gametype")}),$("#gametype").children("button").each(function(){var a=this;$(this).click(function(){chooseGameType(a.id)})}),$("#start").click(function(){removeSection("#menu-container"),showSection("#main-container")}),$("#gamelevel").children("button").each(function(){$(this).click(function(){chooseGameLevel(this.id)})});var p1,p2;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;for(var e=0|b,f=Math.max(e>=0?e:d-Math.abs(e),0);f<d;){if(c[f]===a)return!0;f++}return!1}});
=======
function setCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function getCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){setCookie(a,"",-1)}function show(a){$(a).show()}function hide(a){$(a).hide()}function displayPoints(){var a=$("#points");$(a).is(":visible")?hide(a):show(a)}function displayHisto(){var a=$("#histo");$(a).is(":visible")?hide(a):show(a)}function goToManual(){location.href="/manual.html"}function quit(){window.alert("Merci de fermer votre onglet ou votre navigateur")}function displayHighScore(){if(null===highscoreCookies)return!1;var a,b,c=JSON.parse(highscoreCookies),d=9999;do{for(var e in c)c[e].forEach(function(c,f){c<d&&(d=c,a=e,b=f)});addHighScore(a,d),c[a].splice(b,1),0===c[a].length&&delete c[a],d=9999}while(!$.isEmptyObject(c))}function addHighScore(a,b){var c=$("#score-list"),d=$("<li>"+a+" <span class='right'>"+b+"</span></li>");c.append(d)}function chooseGameType(a){switch(a){case"solo":removeSection("#gametype"),showSection("#gamelevel");break;case"duo":removeSection("#gametype"),showSection("#pickname")}}function chooseGameLevel(a){var b=a;switch(b){case"easy":selectMode(b);break;case"medium":selectMode(b);break;case"hard":selectMode(b)}}function selectMode(a){removeSection("#gamelevel"),addModeToButton(a),removeP2(),showSection("#pickname")}function removeP2(){$("#pickname > #groupej2").hide()}function addModeToButton(a){$("#start").attr("mode",a)}function affectName(){startFirstRound()}function startFirstRound(){p1.addRound(),$("#round").html(p1.round)}function removeSection(a){$(a).fadeOut(300)}function showSection(a){setTimeout(function(){$(a).fadeIn(500)},400)}var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a},Player=function(){"use strict";function a(a,b){var c=arguments[2];void 0===c&&(c="duo"),this.id=b,this.name=a,this.round=0,this.score=0,this.eated={},this.mode=c,this.isBot="duo"!==c,$("#player"+this.id).html(this.name)}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.addRound=function(){this.round++},b.addPoints=function(a){var b=this.didCombo(a)?3*a:a;this.score+=b,$("#score"+this.id).html(this.score),$("#last-score-list").prepend("<li>"+this.name+": "+b+" points</li>")},b.cleanEated=function(){this.eated={}},b.didCombo=function(a){return void 0===this.eated[a]?(this.cleanEated(),this.eated[a]=1):this.eated[a]+=1,5===this.eated[a]&&($("body").prepend('<img class="gifEvent" src="/assets/anim/combo.gif" />'),setTimeout(function(){$(".gifEvent").remove()},2e3),this.cleanEated(),!0)},b.move=function(){switch(this.mode){case"easy":return AI.easyMove();case"medium":return AI.mediumMove();case"hard":return AI.hardMove()}},MIXIN$0(a.prototype,b),b=void 0,a}(),AI={possiblePositions:function(){for(var a=[],b=1;b<8;b++){var c=[b,MainChar.currentPosition()[1]];c[0]!==MainChar.currentPosition()[0]&&a.push(c)}for(var d=1;d<8;d++){var e=[MainChar.currentPosition()[0],d];e[1]!==MainChar.currentPosition()[1]&&a.push(e)}return a},getTarget:function(){return"div[data-x="+this.newPosition[0]+"][data-y="+this.newPosition[1]+"]"},setNewPos:function(a){var b=Math.floor(Math.random()*a.length);this.newPosition=a[b]},easyMove:function(){Math.floor(Math.random()*this.possiblePositions().length);return this.setNewPos(this.possiblePositions()),this.moveChar()},mediumMove:function(){for(var a=this.possiblePositions(),b=0;b<a.length;b++)var c=$("div[data-x="+a[b][0]+"][data-y="+a[b][1]+"]");return 0!==c.children().length&&c.find("img").attr("data-id")||(a[i]=null),a=$.grep(a,function(a){return 0==a||a}),a=0===a.length?this.possiblePositions():a,this.setNewPos(a),this.moveChar()},hardMove:function(){for(var a=null,b=0,c=0;c<this.possiblePositions().length;c++){var d=$("div[data-x="+this.possiblePositions()[c][0]+"][data-y="+this.possiblePositions()[c][1]+"]");if(d.children().length>0&&d.find("img").attr("data-id")){var e=d.find("img").data("id");Game.enemies[e].points()>b&&(b=Game.enemies[e].points(),a=this.possiblePositions()[c])}}return this.newPosition=a,this.moveChar()},moveChar:function(){var a=$(this.getTarget()).offset(),b=$("#main-char").parent("div").offset();$("#main-char").css("transition","1s"),$("#main-char").css("left",a.left-b.left),$("#main-char").css("top",a.top-b.top);var c=new Promise(function(a,b){setTimeout(function(){$("#main-char").css("transition","none"),MainChar.eat(AI.getTarget()).then(function(b){a()})},1e3)});return c}},actualPlayer="",turn=1,botIsPlaying=!1,Game={enemies:[],columns_nb:49,mode:"",init:function(){$(document).on("click","#start",function(){Game.mode=$("#start").attr("mode"),Game.setPlayers(),Game.launchGame(),GameAudio.startTheme()})},setPlayers:function(){this.p1=new Player($("#pickname #namej1").val(),1),"duo"!==this.mode?this.p2=new Player("El Scobar",2,this.mode):this.p2=new Player($("#pickname #namej2").val(),2)},launchGame:function(){this.setPlate(),this.setEnemies(),MainChar.init(),this.setEvents()},setPlate:function(){for(var a=0,b=0,c=0;c<Game.columns_nb;c++)c%7===0&&a++,b=c%7+1,$("#game").append("<div data-x='"+b+"' data-y='"+a+"' id='case-"+(c+1)+"' class='case'></div>")},setEvents:function(){$(".case").droppable({accept:function(a){if(MainChar.isOnSameLine($(this).data("x"),$(this).data("y"))&&!MainChar.isOnSameCase($(this).data("x"),$(this).data("y")))return!0},drop:function(a,b){var c=MainChar.eat(a.target);c.then(function(){"duo"!==Game.currentPlayer().mode&&($("#main-char").draggable("disable"),Game.p2.move().then(function(){$("#main-char").draggable({disabled:!1})}))})}})},setEnemies:function(){for(var a=0;a<14;a++)this.enemies.push(new Enemy(0,1)),this.enemies.push(new Enemy(0,2)),this.enemies.push(new Enemy(0,3));for(var b=0;b<5;b++)this.enemies.push(new Enemy(0,4));this.enemies.sort(function(){return.5-Math.random()});for(var c=[],d=0;d<47;d++)[3,10,17,21,22,23,24,25,26,27,31,38,45].includes(d)||c.push(d);var e=c[Math.floor(Math.random()*c.length)];this.enemies.splice(e,0,new Enemy(0,5)),this.showEnemies()},showEnemies:function(){for(var a=0;a<this.enemies.length+1;a++)if(24!==a){var b=a>24?a-1:a,c=a+1,d=Math.random()>=.5?"rotate":"";this.enemies[b].case_id=c,$("#case-"+this.enemies[b].case_id).append("                    <img data-id='"+b+"' class='"+d+"' src='"+this.enemies[b].image()+"'>                ")}},currentPlayer:function(){return this.p2.round>=this.p1.round?this.p1:this.p2},checkVictory:function(){this.winner()&&(this.addHighScore(this.winner()),GameAudio.stopTheme(),GameAudio.audios.effects.win.play(),this.congratulate())},winner:function(){return this.p1.score>=500?this.p1:this.p2.score>=500&&this.p2},congratulate:function(){confirm(this.winner().name+" a gagnÃ© !!!!! Voulez-vous rejouer ?")?document.location.reload():$("#main-char").draggable("disable")},addHighScore:function(a){var b,c={},d=a.name,e=a.round;null!==highscoreCookies?(c=JSON.parse(highscoreCookies),c.hasOwnProperty(d)?c[d].push(e):c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b)):(c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b))}};MainChar={init:function(){$(".case:not(:has(>img))").append("<img id='main-char' style='z-index:9999;' src='assets/img/personnageprincipal.png'>"),this.updatePosition($("#main-char").parent("div")),this.makeDraggable()},eat:function(a){var b=$(a).find("img").data("id"),c=$(a).data("x"),d=$(a).data("y"),e=new Promise(function(e,f){if("undefined"!=typeof b&&MainChar.isOnSameLine(c,d)){var g=$("#main-char"),h=$(a).find("img");Game.currentPlayer().addPoints(Game.enemies[b].points()),GameAudio.audios.effects.beat.play(),g.css("right","+=25"),h.css("left","+=25"),h.attr("src","/assets/anim/animEnemy"+Game.enemies[b].type+".gif"),g.attr("src","/assets/anim/animPersoPrincipal.gif"),setTimeout(function(){g.css("right","+=-25"),h.remove(),g.attr("src","/assets/img/personnageprincipal.png"),Game.enemies[b]=null,Game.checkVictory(),e()},1e3)}else e()});return Game.currentPlayer().addRound(),this.updatePosition(a),e},isOnSameLine:function(a,b){return $("#main-char").data("x")===a||$("#main-char").data("y")===b},isOnSameCase:function(a,b){return $("#main-char").data("x")===a&&$("#main-char").data("y")===b},currentPosition:function(){return[parseInt($("#main-char").data("x")),parseInt($("#main-char").data("y"))]},updatePosition:function(a){$("#main-char").data("x",$(a).data("x")),$("#main-char").data("y",$(a).data("y")),Game.currentPlayer().name!=actualPlayer&&(1==turn?($(".player > #player1").parent().removeClass("inactive").addClass("active"),$(".player > #player2").parent().removeClass("active").addClass("inactive"),turn=2):($(".player > #player1").parent().removeClass("active").addClass("inactive"),$(".player > #player2").parent().removeClass("inactive").addClass("active"),turn=1)),actualPlayer=Game.currentPlayer().name},makeDraggable:function(){$("#main-char").draggable({containment:"#game",revert:function(a,b){return a||$("#main-char").attr("src","/assets/anim/rollingAnimation.gif"),!a},start:function(){$("#main-char").attr("src","/assets/anim/dragAnimation.gif")},stop:function(){"/assets/anim/dragAnimation.gif"==$("#main-char").attr("src")&&$("#main-char").attr("src","/assets/img/personnageprincipal.png")}})}};var Enemy=function(){"use strict";function a(a,b){this.case_id=a,this.type=b}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.points=function(){var a=0;switch(this.type){case 1:a=10;break;case 2:a=20;break;case 3:a=30;break;case 4:a=50;break;case 5:a=100}return a},b.image=function(){return"assets/img/ennemy"+this.type+".png"},MIXIN$0(a.prototype,b),b=void 0,a}();Game.init();var highscoreCookies=getCookie("highscore");displayHighScore(),$("#play").click(function(){removeSection("#menu"),showSection("#gametype")}),$("#gametype").children("button").each(function(){var a=this;$(this).click(function(){chooseGameType(a.id)})}),$("#start").click(function(){removeSection("#menu-container"),showSection("#main-container")}),$("#gamelevel").children("button").each(function(){$(this).click(function(){chooseGameLevel(this.id)})});var p1,p2;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;for(var e=0|b,f=Math.max(e>=0?e:d-Math.abs(e),0);f<d;){if(c[f]===a)return!0;f++}return!1}});
>>>>>>> Add promise for async function and remove draggable when bot is playing
=======
function setCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function getCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){setCookie(a,"",-1)}function show(a){$(a).show()}function hide(a){$(a).hide()}function displayPoints(){var a=$("#points");$(a).is(":visible")?hide(a):show(a)}function displayHisto(){var a=$("#histo");$(a).is(":visible")?hide(a):show(a)}function goToManual(){location.href="/manual.html"}function quit(){window.alert("Merci de fermer votre onglet ou votre navigateur")}function displayHighScore(){if(null===highscoreCookies)return!1;var a,b,c=JSON.parse(highscoreCookies),d=9999;do{for(var e in c)c[e].forEach(function(c,f){c<d&&(d=c,a=e,b=f)});addHighScore(a,d),c[a].splice(b,1),0===c[a].length&&delete c[a],d=9999}while(!$.isEmptyObject(c))}function addHighScore(a,b){var c=$("#score-list"),d=$("<li>"+a+" <span class='right'>"+b+"</span></li>");c.append(d)}function chooseGameType(a){switch(a){case"solo":removeSection("#gametype"),showSection("#gamelevel");break;case"duo":removeSection("#gametype"),showSection("#pickname")}}function chooseGameLevel(a){var b=a;switch(b){case"easy":selectMode(b);break;case"medium":selectMode(b);break;case"hard":selectMode(b)}}function selectMode(a){removeSection("#gamelevel"),addModeToButton(a),removeP2(),showSection("#pickname")}function removeP2(){$("#pickname > #groupej2").hide()}function addModeToButton(a){$("#start").attr("mode",a)}function affectName(){startFirstRound()}function startFirstRound(){p1.addRound(),$("#round").html(p1.round)}function removeSection(a){$(a).fadeOut(300)}function showSection(a){setTimeout(function(){$(a).fadeIn(500)},400)}var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a};GameAudio={audios:{effects:{mute:!1,beat:new Audio("assets/audio/beat.mp3"),jump:new Audio("assets/audio/jump.mp3"),lose:new Audio("assets/audio/lose.mp3"),win:new Audio("assets/audio/win.mp3")},theme:{mute:!1,main:new Audio("assets/audio/theme.mp3")}},refresh:function(){this.audios.theme.mute?this.audios.theme.main.pause():this.audios.theme.main.play()},startTheme:function(){this.audios.theme.main.play(),this.audios.theme.main.volume=.2,this.audios.theme.main.loop=!0},stopTheme:function(){this.audios.theme.main.pause()},toggleMute:function(a,b){return this.audios[a].mute=!this.audios[a].mute,b===!1?this.audios[a].mute=!1:b===!0&&(this.audios[a].mute=!0),this.refresh(),this.audios[a].mute},play:function(a){this.audios.effects.mute||this.audios.effects[a].play()}};var Player=function(){"use strict";function a(a,b){var c=arguments[2];void 0===c&&(c="duo"),this.id=b,this.name=a,this.round=0,this.score=0,this.eated={},this.mode=c,this.isBot="duo"!==c,$("#player"+this.id).html(this.name)}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.addRound=function(){this.round++},b.addPoints=function(a){var b=this.didCombo(a)?3*a:a;this.score+=b,$("#score"+this.id).html(this.score),$("#last-score-list").prepend("<li>"+this.name+": "+b+" points</li>")},b.cleanEated=function(){this.eated={}},b.didCombo=function(a){return void 0===this.eated[a]?(this.cleanEated(),this.eated[a]=1):this.eated[a]+=1,5===this.eated[a]&&($("body").prepend('<img class="gifEvent" src="/assets/anim/combo.gif" />'),setTimeout(function(){$(".gifEvent").remove()},2e3),this.cleanEated(),!0)},b.move=function(){switch(this.mode){case"easy":return AI.easyMove();case"medium":return AI.mediumMove();case"hard":return AI.hardMove()}},MIXIN$0(a.prototype,b),b=void 0,a}(),AI={possiblePositions:function(){for(var a=[],b=1;b<8;b++){var c=[b,MainChar.currentPosition()[1]];c[0]!==MainChar.currentPosition()[0]&&a.push(c)}for(var d=1;d<8;d++){var e=[MainChar.currentPosition()[0],d];e[1]!==MainChar.currentPosition()[1]&&a.push(e)}return a},getTarget:function(){return"div[data-x="+this.newPosition[0]+"][data-y="+this.newPosition[1]+"]"},setNewPos:function(a){var b=Math.floor(Math.random()*a.length);this.newPosition=a[b]},easyMove:function(){Math.floor(Math.random()*this.possiblePositions().length);return this.setNewPos(this.possiblePositions()),this.moveChar()},mediumMove:function(){for(var a=this.possiblePositions(),b=0;b<a.length;b++){var c=$("div[data-x="+a[b][0]+"][data-y="+a[b][1]+"]");0!==c.children().length&&c.find("img").attr("data-id")||(a[b]=null)}return a=$.grep(a,function(a){return 0==a||a}),a=0===a.length?this.possiblePositions():a,this.setNewPos(a),this.moveChar()},hardMove:function(){for(var a=null,b=0,c=0;c<this.possiblePositions().length;c++){var d=$("div[data-x="+this.possiblePositions()[c][0]+"][data-y="+this.possiblePositions()[c][1]+"]");if(d.children().length>0&&d.find("img").attr("data-id")){var e=d.find("img").data("id");Game.enemies[e].points()>b&&(b=Game.enemies[e].points(),a=this.possiblePositions()[c])}}return this.newPosition=a,this.moveChar()},moveChar:function(){var a=$(this.getTarget()).offset(),b=$("#main-char").parent("div").offset();$("#main-char").css("transition","1s"),$("#main-char").css("left",a.left-b.left),$("#main-char").css("top",a.top-b.top);var c=new Promise(function(a,b){setTimeout(function(){$("#main-char").css("transition","none"),MainChar.eat(AI.getTarget()).then(function(b){a()})},1e3)});return c}},actualPlayer="",turn=1,botIsPlaying=!1,Game={enemies:[],columns_nb:49,mode:"",init:function(){$(document).on("click","#start",function(){Game.mode=$("#start").attr("mode"),Game.setPlayers(),Game.launchGame(),GameAudio.startTheme()})},setPlayers:function(){this.p1=new Player($("#pickname #namej1").val(),1),"duo"!==this.mode?this.p2=new Player("El Scobar",2,this.mode):this.p2=new Player($("#pickname #namej2").val(),2)},launchGame:function(){this.setPlate(),this.setEnemies(),MainChar.init(),this.setEvents()},setPlate:function(){for(var a=0,b=0,c=0;c<Game.columns_nb;c++)c%7===0&&a++,b=c%7+1,$("#game").append("<div data-x='"+b+"' data-y='"+a+"' id='case-"+(c+1)+"' class='case'></div>")},setEvents:function(){$(".case").droppable({accept:function(a){if(MainChar.isOnSameLine($(this).data("x"),$(this).data("y"))&&!MainChar.isOnSameCase($(this).data("x"),$(this).data("y")))return!0},drop:function(a,b){var c=MainChar.eat(a.target);c.then(function(){"duo"!==Game.currentPlayer().mode&&($("#main-char").draggable("disable"),Game.p2.move().then(function(){$("#main-char").draggable({disabled:!1})}))})}})},setEnemies:function(){for(var a=0;a<14;a++)this.enemies.push(new Enemy(0,1)),this.enemies.push(new Enemy(0,2)),this.enemies.push(new Enemy(0,3));for(var b=0;b<5;b++)this.enemies.push(new Enemy(0,4));this.enemies.sort(function(){return.5-Math.random()});for(var c=[],d=0;d<47;d++)[3,10,17,21,22,23,24,25,26,27,31,38,45].includes(d)||c.push(d);var e=c[Math.floor(Math.random()*c.length)];this.enemies.splice(e,0,new Enemy(0,5)),this.showEnemies()},showEnemies:function(){for(var a=0;a<this.enemies.length+1;a++)if(24!==a){var b=a>24?a-1:a,c=a+1,d=Math.random()>=.5?"rotate":"";this.enemies[b].case_id=c,$("#case-"+this.enemies[b].case_id).append("                    <img data-id='"+b+"' class='"+d+"' src='"+this.enemies[b].image()+"'>                ")}},currentPlayer:function(){return this.p2.round>=this.p1.round?this.p1:this.p2},checkVictory:function(){this.winner()&&(this.addHighScore(this.winner()),GameAudio.stopTheme(),GameAudio.audios.effects.win.play(),this.congratulate())},winner:function(){return this.p1.score>=500?this.p1:this.p2.score>=500&&this.p2},congratulate:function(){confirm(this.winner().name+" a gagnÃ© !!!!! Voulez-vous rejouer ?")?document.location.reload():$("#main-char").draggable("disable")},addHighScore:function(a){var b,c={},d=a.name,e=a.round;null!==highscoreCookies?(c=JSON.parse(highscoreCookies),c.hasOwnProperty(d)?c[d].push(e):c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b)):(c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b))}};MainChar={init:function(){$(".case:not(:has(>img))").append("<img id='main-char' style='z-index:9999;' src='assets/img/personnageprincipal.png'>"),this.updatePosition($("#main-char").parent("div")),this.makeDraggable()},eat:function(a){var b=$(a).find("img").data("id"),c=$(a).data("x"),d=$(a).data("y"),e=new Promise(function(e,f){if("undefined"!=typeof b&&MainChar.isOnSameLine(c,d)){var g=$("#main-char"),h=$(a).find("img");Game.currentPlayer().addPoints(Game.enemies[b].points()),GameAudio.audios.effects.beat.play(),g.css("right","+=25"),h.css("left","+=25"),h.attr("src","/assets/anim/animEnemy"+Game.enemies[b].type+".gif"),g.attr("src","/assets/anim/animPersoPrincipal.gif"),setTimeout(function(){g.css("right","+=-25"),h.remove(),g.attr("src","/assets/img/personnageprincipal.png"),Game.enemies[b]=null,Game.checkVictory(),e()},1e3)}else e()});return Game.currentPlayer().addRound(),this.updatePosition(a),e},isOnSameLine:function(a,b){return $("#main-char").data("x")===a||$("#main-char").data("y")===b},isOnSameCase:function(a,b){return $("#main-char").data("x")===a&&$("#main-char").data("y")===b},currentPosition:function(){return[parseInt($("#main-char").data("x")),parseInt($("#main-char").data("y"))]},updatePosition:function(a){$("#main-char").data("x",$(a).data("x")),$("#main-char").data("y",$(a).data("y")),Game.currentPlayer().name!=actualPlayer&&(1==turn?($(".player > #player1").parent().removeClass("inactive").addClass("active"),$(".player > #player2").parent().removeClass("active").addClass("inactive"),turn=2):($(".player > #player1").parent().removeClass("active").addClass("inactive"),$(".player > #player2").parent().removeClass("inactive").addClass("active"),turn=1)),actualPlayer=Game.currentPlayer().name},makeDraggable:function(){$("#main-char").draggable({containment:"#game",revert:function(a,b){return a||$("#main-char").attr("src","/assets/anim/rollingAnimation.gif"),!a},start:function(){$("#main-char").attr("src","/assets/anim/dragAnimation.gif")},stop:function(){"/assets/anim/dragAnimation.gif"==$("#main-char").attr("src")&&$("#main-char").attr("src","/assets/img/personnageprincipal.png")}})}};var Enemy=function(){"use strict";function a(a,b){this.case_id=a,this.type=b}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.points=function(){var a=0;switch(this.type){case 1:a=10;break;case 2:a=20;break;case 3:a=30;break;case 4:a=50;break;case 5:a=100}return a},b.image=function(){return"assets/img/ennemy"+this.type+".png"},MIXIN$0(a.prototype,b),b=void 0,a}();Game.init();var highscoreCookies=getCookie("highscore");displayHighScore(),$("#play").click(function(){removeSection("#menu"),showSection("#gametype")}),$("#gametype").children("button").each(function(){var a=this;$(this).click(function(){chooseGameType(a.id)})}),$("#start").click(function(){removeSection("#menu-container"),showSection("#main-container")}),$("#gamelevel").children("button").each(function(){$(this).click(function(){chooseGameLevel(this.id)})});var p1,p2;if(!window.Promise)var Promise=require("es6-promise").Promise;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;for(var e=0|b,f=Math.max(e>=0?e:d-Math.abs(e),0);f<d;){if(c[f]===a)return!0;f++}return!1}});
>>>>>>> add support for promise for IE11
=======
function setCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function getCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){setCookie(a,"",-1)}function show(a){$(a).show()}function hide(a){$(a).hide()}function displayPoints(){var a=$("#points");$(a).is(":visible")?hide(a):show(a)}function displayHisto(){var a=$("#histo");$(a).is(":visible")?hide(a):show(a)}function goToManual(){location.href="/manual.html"}function quit(){window.alert("Merci de fermer votre onglet ou votre navigateur")}function displayHighScore(){if(null===highscoreCookies)return!1;var a,b,c=JSON.parse(highscoreCookies),d=9999;do{for(var e in c)c[e].forEach(function(c,f){c<d&&(d=c,a=e,b=f)});addHighScore(a,d),c[a].splice(b,1),0===c[a].length&&delete c[a],d=9999}while(!$.isEmptyObject(c))}function addHighScore(a,b){var c=$("#score-list"),d=$("<li>"+a+" <span class='right'>"+b+"</span></li>");c.append(d)}function chooseGameType(a){switch(a){case"solo":removeSection("#gametype"),showSection("#gamelevel");break;case"duo":removeSection("#gametype"),showSection("#pickname")}}function chooseGameLevel(a){var b=a;switch(b){case"easy":selectMode(b);break;case"medium":selectMode(b);break;case"hard":selectMode(b)}}function selectMode(a){removeSection("#gamelevel"),addModeToButton(a),removeP2(),showSection("#pickname")}function removeP2(){$("#pickname > #groupej2").hide()}function addModeToButton(a){$("#start").attr("mode",a)}function affectName(){startFirstRound()}function startFirstRound(){p1.addRound(),$("#round").html(p1.round)}function removeSection(a){$(a).fadeOut(300)}function showSection(a){setTimeout(function(){$(a).fadeIn(500)},400)}var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a};if(!window.Promise)var Promise=require("es6-promise").Promise;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;for(var e=0|b,f=Math.max(e>=0?e:d-Math.abs(e),0);f<d;){if(c[f]===a)return!0;f++}return!1}}),GameAudio={audios:{effects:{mute:!1,beat:new Audio("assets/audio/beat.mp3"),jump:new Audio("assets/audio/jump.mp3"),lose:new Audio("assets/audio/lose.mp3"),win:new Audio("assets/audio/win.mp3")},theme:{mute:!1,main:new Audio("assets/audio/theme.mp3")}},refresh:function(){this.audios.theme.mute?this.audios.theme.main.pause():this.audios.theme.main.play()},startTheme:function(){this.audios.theme.main.play(),this.audios.theme.main.volume=.2,this.audios.theme.main.loop=!0},stopTheme:function(){this.audios.theme.main.pause()},toggleMute:function(a,b){return this.audios[a].mute=!this.audios[a].mute,b===!1?this.audios[a].mute=!1:b===!0&&(this.audios[a].mute=!0),this.refresh(),this.audios[a].mute},play:function(a){this.audios.effects.mute||this.audios.effects[a].play()}};var Player=function(){"use strict";function a(a,b){var c=arguments[2];void 0===c&&(c="duo"),this.id=b,this.name=a,this.round=0,this.score=0,this.eated={},this.mode=c,this.isBot="duo"!==c,$("#player"+this.id).html(this.name)}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.addRound=function(){this.round++},b.addPoints=function(a){var b=this.didCombo(a)?3*a:a;this.score+=b,$("#score"+this.id).html(this.score),$("#last-score-list").prepend("<li>"+this.name+": "+b+" points</li>")},b.cleanEated=function(){this.eated={}},b.didCombo=function(a){return void 0===this.eated[a]?(this.cleanEated(),this.eated[a]=1):this.eated[a]+=1,5===this.eated[a]&&($("body").prepend('<img class="gifEvent" src="/assets/anim/combo.gif" />'),setTimeout(function(){$(".gifEvent").remove()},2e3),this.cleanEated(),!0)},b.move=function(){switch(this.mode){case"easy":return AI.easyMove();case"medium":return AI.mediumMove();case"hard":return AI.hardMove()}},MIXIN$0(a.prototype,b),b=void 0,a}(),AI={possiblePositions:function(){for(var a=[],b=1;b<8;b++){var c=[b,MainChar.currentPosition()[1]];c[0]!==MainChar.currentPosition()[0]&&a.push(c)}for(var d=1;d<8;d++){var e=[MainChar.currentPosition()[0],d];e[1]!==MainChar.currentPosition()[1]&&a.push(e)}return a},getTarget:function(){return"div[data-x="+this.newPosition[0]+"][data-y="+this.newPosition[1]+"]"},setNewPos:function(a){var b=Math.floor(Math.random()*a.length);this.newPosition=a[b]},easyMove:function(){Math.floor(Math.random()*this.possiblePositions().length);return this.setNewPos(this.possiblePositions()),this.moveChar()},mediumMove:function(){for(var a=this.possiblePositions(),b=0;b<a.length;b++){var c=$("div[data-x="+a[b][0]+"][data-y="+a[b][1]+"]");0!==c.children().length&&c.find("img").attr("data-id")||(a[b]=null)}return a=$.grep(a,function(a){return 0==a||a}),a=0===a.length?this.possiblePositions():a,this.setNewPos(a),this.moveChar()},hardMove:function(){for(var a=null,b=0,c=0;c<this.possiblePositions().length;c++){var d=$("div[data-x="+this.possiblePositions()[c][0]+"][data-y="+this.possiblePositions()[c][1]+"]");if(d.children().length>0&&d.find("img").attr("data-id")){var e=d.find("img").data("id");Game.enemies[e].points()>b&&(b=Game.enemies[e].points(),a=this.possiblePositions()[c])}}return this.newPosition=a,this.moveChar()},moveChar:function(){var a=$(this.getTarget()).offset(),b=$("#main-char").parent("div").offset();$("#main-char").css("transition","1s"),$("#main-char").css("left",a.left-b.left),$("#main-char").css("top",a.top-b.top);var c=new Promise(function(a,b){setTimeout(function(){$("#main-char").css("transition","none"),MainChar.eat(AI.getTarget()).then(function(b){a()})},1e3)});return c}},actualPlayer="",turn=1,botIsPlaying=!1,Game={enemies:[],columns_nb:49,mode:"",init:function(){$(document).on("click","#start",function(){Game.mode=$("#start").attr("mode"),Game.setPlayers(),Game.launchGame(),GameAudio.startTheme()})},setPlayers:function(){this.p1=new Player($("#pickname #namej1").val(),1),"duo"!==this.mode?this.p2=new Player("El Scobar",2,this.mode):this.p2=new Player($("#pickname #namej2").val(),2)},launchGame:function(){this.setPlate(),this.setEnemies(),MainChar.init(),this.setEvents()},setPlate:function(){for(var a=0,b=0,c=0;c<Game.columns_nb;c++)c%7===0&&a++,b=c%7+1,$("#game").append("<div data-x='"+b+"' data-y='"+a+"' id='case-"+(c+1)+"' class='case'></div>")},setEvents:function(){$(".case").droppable({accept:function(a){if(MainChar.isOnSameLine($(this).data("x"),$(this).data("y"))&&!MainChar.isOnSameCase($(this).data("x"),$(this).data("y")))return!0},drop:function(a,b){var c=MainChar.eat(a.target);c.then(function(){"duo"!==Game.currentPlayer().mode&&($("#main-char").draggable("disable"),Game.p2.move().then(function(){$("#main-char").draggable({disabled:!1})}))})}})},setEnemies:function(){for(var a=0;a<14;a++)this.enemies.push(new Enemy(0,1)),this.enemies.push(new Enemy(0,2)),this.enemies.push(new Enemy(0,3));for(var b=0;b<5;b++)this.enemies.push(new Enemy(0,4));this.enemies.sort(function(){return.5-Math.random()});for(var c=[],d=0;d<47;d++)[3,10,17,21,22,23,24,25,26,27,31,38,45].includes(d)||c.push(d);var e=c[Math.floor(Math.random()*c.length)];this.enemies.splice(e,0,new Enemy(0,5)),this.showEnemies()},showEnemies:function(){for(var a=0;a<this.enemies.length+1;a++)if(24!==a){var b=a>24?a-1:a,c=a+1,d=Math.random()>=.5?"rotate":"";this.enemies[b].case_id=c,$("#case-"+this.enemies[b].case_id).append("                    <img data-id='"+b+"' class='"+d+"' src='"+this.enemies[b].image()+"'>                ")}},currentPlayer:function(){return this.p2.round>=this.p1.round?this.p1:this.p2},checkVictory:function(){this.winner()&&(this.addHighScore(this.winner()),GameAudio.stopTheme(),GameAudio.audios.effects.win.play(),this.congratulate())},winner:function(){return this.p1.score>=500?this.p1:this.p2.score>=500&&this.p2},congratulate:function(){confirm(this.winner().name+" a gagnÃ© !!!!! Voulez-vous rejouer ?")?document.location.reload():$("#main-char").draggable("disable")},addHighScore:function(a){var b,c={},d=a.name,e=a.round;null!==highscoreCookies?(c=JSON.parse(highscoreCookies),c.hasOwnProperty(d)?c[d].push(e):c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b)):(c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b))}};MainChar={init:function(){$(".case:not(:has(>img))").append("<img id='main-char' style='z-index:9999;' src='assets/img/personnageprincipal.png'>"),this.updatePosition($("#main-char").parent("div")),this.makeDraggable()},eat:function(a){var b=$(a).find("img").data("id"),c=$(a).data("x"),d=$(a).data("y"),e=new Promise(function(e,f){if("undefined"!=typeof b&&MainChar.isOnSameLine(c,d)){var g=$("#main-char"),h=$(a).find("img");Game.currentPlayer().addPoints(Game.enemies[b].points()),GameAudio.audios.effects.beat.play(),g.css("right","+=25"),h.css("left","+=25"),h.attr("src","/assets/anim/animEnemy"+Game.enemies[b].type+".gif"),g.attr("src","/assets/anim/animPersoPrincipal.gif"),setTimeout(function(){g.css("right","+=-25"),h.remove(),g.attr("src","/assets/img/personnageprincipal.png"),Game.enemies[b]=null,Game.checkVictory(),e()},1e3)}else e()});return Game.currentPlayer().addRound(),this.updatePosition(a),e},isOnSameLine:function(a,b){return $("#main-char").data("x")===a||$("#main-char").data("y")===b},isOnSameCase:function(a,b){return $("#main-char").data("x")===a&&$("#main-char").data("y")===b},currentPosition:function(){return[parseInt($("#main-char").data("x")),parseInt($("#main-char").data("y"))]},updatePosition:function(a){$("#main-char").data("x",$(a).data("x")),$("#main-char").data("y",$(a).data("y")),Game.currentPlayer().name!=actualPlayer&&(1==turn?($(".player > #player1").parent().removeClass("inactive").addClass("active"),$(".player > #player2").parent().removeClass("active").addClass("inactive"),turn=2):($(".player > #player1").parent().removeClass("active").addClass("inactive"),$(".player > #player2").parent().removeClass("inactive").addClass("active"),turn=1)),actualPlayer=Game.currentPlayer().name},makeDraggable:function(){$("#main-char").draggable({containment:"#game",revert:function(a,b){return a||$("#main-char").attr("src","/assets/anim/rollingAnimation.gif"),!a},start:function(){$("#main-char").attr("src","/assets/anim/dragAnimation.gif")},stop:function(){"/assets/anim/dragAnimation.gif"==$("#main-char").attr("src")&&$("#main-char").attr("src","/assets/img/personnageprincipal.png")}})}};var Enemy=function(){"use strict";function a(a,b){this.case_id=a,this.type=b}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.points=function(){var a=0;switch(this.type){case 1:a=10;break;case 2:a=20;break;case 3:a=30;break;case 4:a=50;break;case 5:a=100}return a},b.image=function(){return"assets/img/ennemy"+this.type+".png"},MIXIN$0(a.prototype,b),b=void 0,a}();Game.init();var highscoreCookies=getCookie("highscore");displayHighScore(),$("#play").click(function(){removeSection("#menu"),showSection("#gametype")}),$("#gametype").children("button").each(function(){var a=this;$(this).click(function(){chooseGameType(a.id)})}),$("#start").click(function(){removeSection("#menu-container"),showSection("#main-container")}),$("#gamelevel").children("button").each(function(){$(this).click(function(){chooseGameLevel(this.id)})});var p1,p2;
>>>>>>> Add perf optimisation
=======
function setCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function getCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){setCookie(a,"",-1)}function show(a){$(a).show()}function hide(a){$(a).hide()}function displayPoints(){var a=$("#points");$(a).is(":visible")?hide(a):show(a)}function displayHisto(){var a=$("#histo");$(a).is(":visible")?hide(a):show(a)}function goToManual(){location.href="/manual.html"}function quit(){window.alert("Merci de fermer votre onglet ou votre navigateur")}function displayHighScore(){if(null===highscoreCookies)return!1;var a,b,c=JSON.parse(highscoreCookies),d=9999;do{for(var e in c)c[e].forEach(function(c,f){c<d&&(d=c,a=e,b=f)});addHighScore(a,d),c[a].splice(b,1),0===c[a].length&&delete c[a],d=9999}while(!$.isEmptyObject(c))}function addHighScore(a,b){var c=$("#score-list"),d=$("<li>"+a+" <span class='right'>"+b+"</span></li>");c.append(d)}function chooseGameType(a){switch(a){case"solo":removeSection("#gametype"),showSection("#gamelevel");break;case"duo":removeSection("#gametype"),showSection("#pickname")}}function chooseGameLevel(a){var b=a;switch(b){case"easy":selectMode(b);break;case"medium":selectMode(b);break;case"hard":selectMode(b)}}function selectMode(a){removeSection("#gamelevel"),addModeToButton(a),removeP2(),showSection("#pickname")}function removeP2(){$("#pickname > #groupej2").hide()}function addModeToButton(a){$("#start").attr("mode",a)}function affectName(){startFirstRound()}function startFirstRound(){p1.addRound(),$("#round").html(p1.round)}function removeSection(a){$(a).fadeOut(300)}function showSection(a){setTimeout(function(){$(a).fadeIn(500)},400)}var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a};!function(a){function b(){}function c(a,b){return function(){a.apply(b,arguments)}}function d(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],j(a,this)}function e(a,b){for(;3===a._state;)a=a._value;return 0===a._state?void a._deferreds.push(b):(a._handled=!0,void d._immediateFn(function(){var c=1===a._state?b.onFulfilled:b.onRejected;if(null===c)return void(1===a._state?f:g)(b.promise,a._value);var d;try{d=c(a._value)}catch(a){return void g(b.promise,a)}f(b.promise,d)}))}function f(a,b){try{if(b===a)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var e=b.then;if(b instanceof d)return a._state=3,a._value=b,void h(a);if("function"==typeof e)return void j(c(e,b),a)}a._state=1,a._value=b,h(a)}catch(b){g(a,b)}}function g(a,b){a._state=2,a._value=b,h(a)}function h(a){2===a._state&&0===a._deferreds.length&&d._immediateFn(function(){a._handled||d._unhandledRejectionFn(a._value)});for(var b=0,c=a._deferreds.length;b<c;b++)e(a,a._deferreds[b]);a._deferreds=null}function i(a,b,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.promise=c}function j(a,b){var c=!1;try{a(function(a){c||(c=!0,f(b,a))},function(a){c||(c=!0,g(b,a))})}catch(a){if(c)return;c=!0,g(b,a)}}var k=setTimeout;d.prototype.catch=function(a){return this.then(null,a)},d.prototype.then=function(a,c){var d=new this.constructor(b);return e(this,new i(a,c,d)),d},d.all=function(a){var b=Array.prototype.slice.call(a);return new d(function(a,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}b[f]=g,0===--e&&a(b)}catch(a){c(a)}}if(0===b.length)return a([]);for(var e=b.length,f=0;f<b.length;f++)d(f,b[f])})},d.resolve=function(a){return a&&"object"==typeof a&&a.constructor===d?a:new d(function(b){b(a)})},d.reject=function(a){return new d(function(b,c){c(a)})},d.race=function(a){return new d(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},d._immediateFn="function"==typeof setImmediate&&function(a){setImmediate(a)}||function(a){k(a,0)},d._unhandledRejectionFn=function(a){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",a)},d._setImmediateFn=function(a){d._immediateFn=a},d._setUnhandledRejectionFn=function(a){d._unhandledRejectionFn=a},"undefined"!=typeof module&&module.exports?module.exports=d:a.Promise||(a.Promise=d)}(this),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;for(var e=0|b,f=Math.max(e>=0?e:d-Math.abs(e),0);f<d;){if(c[f]===a)return!0;f++}return!1}}),GameAudio={audios:{effects:{mute:!1,beat:new Audio("assets/audio/beat.mp3"),jump:new Audio("assets/audio/jump.mp3"),lose:new Audio("assets/audio/lose.mp3"),win:new Audio("assets/audio/win.mp3")},theme:{mute:!1,main:new Audio("assets/audio/theme.mp3")}},refresh:function(){this.audios.theme.mute?this.audios.theme.main.pause():this.audios.theme.main.play()},startTheme:function(){this.audios.theme.main.play(),this.audios.theme.main.volume=.2,this.audios.theme.main.loop=!0},stopTheme:function(){this.audios.theme.main.pause()},toggleMute:function(a,b){return this.audios[a].mute=!this.audios[a].mute,b===!1?this.audios[a].mute=!1:b===!0&&(this.audios[a].mute=!0),this.refresh(),this.audios[a].mute},play:function(a){this.audios.effects.mute||this.audios.effects[a].play()}};var Player=function(){"use strict";function a(a,b){var c=arguments[2];void 0===c&&(c="duo"),this.id=b,this.name=a,this.round=0,this.score=0,this.eated={},this.mode=c,this.isBot="duo"!==c,$("#player"+this.id).html(this.name)}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.addRound=function(){this.round++},b.addPoints=function(a){var b=this.didCombo(a)?3*a:a;this.score+=b,$("#score"+this.id).html(this.score),$("#last-score-list").prepend("<li>"+this.name+": "+b+" points</li>")},b.cleanEated=function(){this.eated={}},b.didCombo=function(a){return void 0===this.eated[a]?(this.cleanEated(),this.eated[a]=1):this.eated[a]+=1,5===this.eated[a]&&($("body").prepend('<img class="gifEvent" src="/assets/anim/combo.gif" />'),setTimeout(function(){$(".gifEvent").remove()},2e3),this.cleanEated(),!0)},b.move=function(){switch(this.mode){case"easy":return AI.easyMove();case"medium":return AI.mediumMove();case"hard":return AI.hardMove()}},MIXIN$0(a.prototype,b),b=void 0,a}(),AI={possiblePositions:function(){for(var a=[],b=1;b<8;b++){var c=[b,MainChar.currentPosition()[1]];c[0]!==MainChar.currentPosition()[0]&&a.push(c)}for(var d=1;d<8;d++){var e=[MainChar.currentPosition()[0],d];e[1]!==MainChar.currentPosition()[1]&&a.push(e)}return a},getTarget:function(){return"div[data-x="+this.newPosition[0]+"][data-y="+this.newPosition[1]+"]"},setNewPos:function(a){var b=Math.floor(Math.random()*a.length);this.newPosition=a[b]},easyMove:function(){Math.floor(Math.random()*this.possiblePositions().length);return this.setNewPos(this.possiblePositions()),this.moveChar()},mediumMove:function(){for(var a=this.possiblePositions(),b=0;b<a.length;b++){var c=$("div[data-x="+a[b][0]+"][data-y="+a[b][1]+"]");0!==c.children().length&&c.find("img").attr("data-id")||(a[b]=null)}return a=$.grep(a,function(a){return 0==a||a}),a=0===a.length?this.possiblePositions():a,this.setNewPos(a),this.moveChar()},hardMove:function(){for(var a=null,b=0,c=0;c<this.possiblePositions().length;c++){var d=$("div[data-x="+this.possiblePositions()[c][0]+"][data-y="+this.possiblePositions()[c][1]+"]");if(d.children().length>0&&d.find("img").attr("data-id")){var e=d.find("img").data("id");Game.enemies[e].points()>b&&(b=Game.enemies[e].points(),a=this.possiblePositions()[c])}}return this.newPosition=a,this.moveChar()},moveChar:function(){var a=$(this.getTarget()).offset(),b=$("#main-char").parent("div").offset();$("#main-char").css("transition","1s"),$("#main-char").css("left",a.left-b.left),$("#main-char").css("top",a.top-b.top);var c=new Promise(function(a,b){setTimeout(function(){$("#main-char").css("transition","none"),MainChar.eat(AI.getTarget()).then(function(b){a()})},1e3)});return c}},actualPlayer="",turn=1,botIsPlaying=!1,Game={enemies:[],columns_nb:49,mode:"",init:function(){$(document).on("click","#start",function(){Game.mode=$("#start").attr("mode"),Game.setPlayers(),Game.launchGame(),GameAudio.startTheme()})},setPlayers:function(){this.p1=new Player($("#pickname #namej1").val(),1),"duo"!==this.mode?this.p2=new Player("El Scobar",2,this.mode):this.p2=new Player($("#pickname #namej2").val(),2)},launchGame:function(){this.setPlate(),this.setEnemies(),MainChar.init(),this.setEvents()},setPlate:function(){for(var a=0,b=0,c=0;c<Game.columns_nb;c++)c%7===0&&a++,b=c%7+1,$("#game").append("<div data-x='"+b+"' data-y='"+a+"' id='case-"+(c+1)+"' class='case'></div>")},setEvents:function(){$(".case").droppable({accept:function(a){if(MainChar.isOnSameLine($(this).data("x"),$(this).data("y"))&&!MainChar.isOnSameCase($(this).data("x"),$(this).data("y")))return!0},drop:function(a,b){$("#main-char").draggable("disable");var c=MainChar.eat(a.target);c.then(function(){"duo"!==Game.currentPlayer().mode?Game.p2.move().then(function(){$("#main-char").draggable({disabled:!1})}):$("#main-char").draggable({disabled:!1})})}})},setEnemies:function(){for(var a=0;a<14;a++)this.enemies.push(new Enemy(0,1)),this.enemies.push(new Enemy(0,2)),this.enemies.push(new Enemy(0,3));for(var b=0;b<5;b++)this.enemies.push(new Enemy(0,4));this.enemies.sort(function(){return.5-Math.random()});for(var c=[],d=0;d<47;d++)[3,10,17,21,22,23,24,25,26,27,31,38,45].includes(d)||c.push(d);var e=c[Math.floor(Math.random()*c.length)];this.enemies.splice(e,0,new Enemy(0,5)),this.showEnemies()},showEnemies:function(){for(var a=0;a<this.enemies.length+1;a++)if(24!==a){var b=a>24?a-1:a,c=a+1,d=Math.random()>=.5?"rotate":"";this.enemies[b].case_id=c,$("#case-"+this.enemies[b].case_id).append("                    <img data-id='"+b+"' class='"+d+"' src='"+this.enemies[b].image()+"'>                ")}},currentPlayer:function(){return this.p2.round>=this.p1.round?this.p1:this.p2},checkVictory:function(){this.winner()&&(this.addHighScore(this.winner()),GameAudio.stopTheme(),GameAudio.audios.effects.win.play(),this.congratulate())},winner:function(){return this.p1.score>=500?this.p1:this.p2.score>=500&&this.p2},congratulate:function(){confirm(this.winner().name+" a gagnÃ© !!!!! Voulez-vous rejouer ?")?document.location.reload():$("#main-char").draggable("disable")},addHighScore:function(a){var b,c={},d=a.name,e=a.round;null!==highscoreCookies?(c=JSON.parse(highscoreCookies),c.hasOwnProperty(d)?c[d].push(e):c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b)):(c[d]=[e],b=JSON.stringify(c),setCookie("highscore",b))}};MainChar={init:function(){$(".case:not(:has(>img))").append("<img id='main-char' style='z-index:9999;' src='assets/img/personnageprincipal.png'>"),this.updatePosition($("#main-char").parent("div")),this.makeDraggable()},eat:function(a){var b=$(a).find("img").data("id"),c=$(a).data("x"),d=$(a).data("y"),e=new Promise(function(e,f){if("undefined"!=typeof b&&MainChar.isOnSameLine(c,d)){var g=$("#main-char"),h=$(a).find("img");Game.currentPlayer().addPoints(Game.enemies[b].points()),GameAudio.audios.effects.beat.play(),g.css("right","+=25"),h.css("left","+=25"),h.attr("src","/assets/anim/animEnemy"+Game.enemies[b].type+".gif"),g.attr("src","/assets/anim/animPersoPrincipal.gif"),setTimeout(function(){g.css("right","+=-25"),h.remove(),g.attr("src","/assets/img/personnageprincipal.png"),Game.enemies[b]=null,Game.checkVictory(),e()},1e3)}else e()});return Game.currentPlayer().addRound(),this.updatePosition(a),e},isOnSameLine:function(a,b){return $("#main-char").data("x")===a||$("#main-char").data("y")===b},isOnSameCase:function(a,b){return $("#main-char").data("x")===a&&$("#main-char").data("y")===b},currentPosition:function(){return[parseInt($("#main-char").data("x")),parseInt($("#main-char").data("y"))]},updatePosition:function(a){$("#main-char").data("x",$(a).data("x")),$("#main-char").data("y",$(a).data("y")),Game.currentPlayer().name!=actualPlayer&&(1==turn?($(".player > #player1").parent().removeClass("inactive").addClass("active"),$(".player > #player2").parent().removeClass("active").addClass("inactive"),turn=2):($(".player > #player1").parent().removeClass("active").addClass("inactive"),$(".player > #player2").parent().removeClass("inactive").addClass("active"),turn=1)),actualPlayer=Game.currentPlayer().name},makeDraggable:function(){$("#main-char").draggable({containment:"#game",revert:function(a,b){return a||$("#main-char").attr("src","/assets/anim/rollingAnimation.gif"),!a},start:function(){$("#main-char").attr("src","/assets/anim/dragAnimation.gif")},stop:function(){"/assets/anim/dragAnimation.gif"==$("#main-char").attr("src")&&$("#main-char").attr("src","/assets/img/personnageprincipal.png")}})}};var Enemy=function(){"use strict";function a(a,b){this.case_id=a,this.type=b}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.points=function(){var a=0;switch(this.type){case 1:a=10;break;case 2:a=20;break;case 3:a=30;break;case 4:a=50;break;case 5:a=100}return a},b.image=function(){return"assets/img/ennemy"+this.type+".png"},MIXIN$0(a.prototype,b),b=void 0,a}();Game.init();var highscoreCookies=getCookie("highscore");displayHighScore(),$("#play").click(function(){removeSection("#menu"),showSection("#gametype")}),$("#gametype").children("button").each(function(){var a=this;$(this).click(function(){chooseGameType(a.id)})}),$("#start").click(function(){removeSection("#menu-container"),showSection("#main-container")}),$("#gamelevel").children("button").each(function(){$(this).click(function(){chooseGameLevel(this.id)})});var p1,p2;
>>>>>>> add verification for undraggable
